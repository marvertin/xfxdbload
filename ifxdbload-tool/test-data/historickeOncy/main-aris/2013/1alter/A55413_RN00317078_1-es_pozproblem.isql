-- @TC:ONCE: ID = V2, A55413_RN00317078_1-es_pozproblem
-- @TC:ONCE: DESCRIPTION = CIBIS-Sale: Problémy opisovaných formuláøù {CUSTOMERREQUEST}
BEGIN WORK;

--
-- es_pozpodklad_mat + arch
--
CREATE TABLE es_pozpodklad_mat (
  serno   SERIAL NOT NULL,
  typ   CHAR(1) NOT NULL,
  stav   CHAR(1)  DEFAULT 'A' NOT NULL,
  refpozadavek   INTEGER NOT NULL,
  typpozadavek   CHAR(1) NOT NULL,
  poradipodkladu   Integer  DEFAULT 1 NOT NULL,
  datzpracdo   DATE NOT NULL,
  poradizprac   Integer  DEFAULT 0 NOT NULL,
  typkomunikace   CHAR(1)  DEFAULT 'E' NOT NULL,
  email   VARCHAR(255),
  emailcc   VARCHAR(255),
  portime   datetime year to second NOT NULL,
  poruser   CHAR(20)  DEFAULT USER NOT NULL,
  zpractime   datetime year to second,
  zpracuser   CHAR(20),
  zrustime   datetime year to second,
  zrususer   CHAR(20),
  reftime   DATETIME YEAR TO SECOND  DEFAULT CURRENT YEAR TO SECOND NOT NULL,
  refuser   CHAR(20)  DEFAULT USER NOT NULL,
  oz_cislo   DECIMAL(16, 0),
  oz_cisloext   CHAR(8),
  oz_cislopcp   DECIMAL(16, 0),
  oz_titul1   CHAR(10),
  oz_jmeno   CHAR(24),
  oz_prijmeni   CHAR(35),
  oz_titul2   CHAR(10),
  oz_adr1   CHAR(45),
  oz_adr2   CHAR(45),
  oz_psc   CHAR(5),
  oz_adr3   CHAR(45),
  oz_email   CHAR(40),
  oz_telefon   CHAR(40),
  ozter_cislo   Integer,
  ozter_nazev   CHAR(40),
  ozter_adr1   CHAR(45),
  ozter_adr2   CHAR(45),
  ozter_psc   CHAR(5),
  ozter_adr3   CHAR(45),
  ozter_email   VARCHAR(255),
  ozter_telefon   CHAR(40),
  ozorg_cislo   Integer,
  ozorg_nazev   CHAR(40),
  ozorg_adr1   CHAR(45),
  ozorg_adr2   CHAR(45),
  ozorg_psc   CHAR(5),
  ozorg_adr3   CHAR(45),
  ozorg_email   VARCHAR(255),
  ozorg_telefon   CHAR(40),
  ozhigh_cislo   DECIMAL(16, 0),
  ozhigh_titul1   CHAR(10),
  ozhigh_jmeno   CHAR(24),
  ozhigh_prijmeni   CHAR(35),
  ozhigh_titul2   CHAR(10),
  ozhigh_adr1   CHAR(45),
  ozhigh_adr2   CHAR(45),
  ozhigh_psc   CHAR(5),
  ozhigh_adr3   CHAR(45),
  ozhigh_email   VARCHAR(255),
  ozhigh_telefon   CHAR(40),
  ozhighter_cislo   Integer,
  ozhighter_nazev   CHAR(40),
  ozhighter_adr1   CHAR(45),
  ozhighter_adr2   CHAR(45),
  ozhighter_psc   CHAR(5),
  ozhighter_adr3   CHAR(45),
  ozhighter_email   VARCHAR(255),
  ozhighter_telefon   CHAR(40),
  poz_smlouva   DECIMAL(16, 0),
  poz_tsml   CHAR(4),
  poz_cc   DECIMAL(16, 2),
  poz_vop   Integer,
  poz_tarif   Integer,
  poz_sp   Integer,
  poz_datuz   DATE,
  pozkl_typid   CHAR(1),
  pozkl_rc   CHAR(13),
  pozkl_titul1   CHAR(10),
  pozkl_jmeno   CHAR(24),
  pozkl_prijmeni   CHAR(35),
  pozkl_titul2   CHAR(10),
  pozkl_datnaroz   DATE,
  pozkl_pohlavi   Integer,
  pozkl_statprisl   CHAR(2),
  pozkl_adresat   CHAR(45),
  pozkl_ulice   CHAR(45),
  pozkl_cislopopisne   CHAR(8),
  pozkl_cisloorientacni   CHAR(8),
  pozkl_psc   CHAR(5),
  pozkl_obec   CHAR(60),
  pozkl_stat   CHAR(2),
  pozzz_typid   CHAR(1),
  pozzz_rc   CHAR(13),
  pozzz_titul1   CHAR(10),
  pozzz_jmeno   CHAR(24),
  pozzz_prijmeni   CHAR(35),
  pozzz_titul2   CHAR(10),
  pozzz_datnaroz   DATE,
  pozzz_pohlavi   Integer,
  pozzz_statprisl   CHAR(2),
  pozzz_adresat   CHAR(45),
  pozzz_ulice   CHAR(45),
  pozzz_cislopopisne   CHAR(8),
  pozzz_cisloorientacni   CHAR(8),
  pozzz_psc   CHAR(5),
  pozzz_obec   CHAR(60),
  pozzz_stat   CHAR(2),
  pozka_adresat   CHAR(45),
  pozka_ulice   CHAR(45),
  pozka_cislopopisne   CHAR(8),
  pozka_cisloorientacni   CHAR(8),
  pozka_psc   CHAR(5),
  pozka_obec   CHAR(60),
  pozka_stat   CHAR(2)
)lock mode row;

--PK
CREATE UNIQUE INDEX es_pozpodklad_mat_pk ON es_pozpodklad_mat(serno);
ALTER TABLE es_pozpodklad_mat ADD CONSTRAINT PRIMARY KEY(serno) CONSTRAINT es_pozpodklad_mat_pk;

--FK
CREATE INDEX es_pozpodklad_mat_i_f1 ON es_pozpodklad_mat(refpozadavek);
ALTER TABLE es_pozpodklad_mat ADD CONSTRAINT FOREIGN KEY(refpozadavek) REFERENCES ses_pozadavekh_mat(serno) CONSTRAINT es_pozpodklad_mat_f1;

--INDEXES

--UNIQUE INDEXES

--CHECKS
ALTER TABLE es_pozpodklad_mat
ADD CONSTRAINT (CHECK (stav IN ('A', 'C', 'Z')) CONSTRAINT es_pozpodklad_mat_c1),
ADD CONSTRAINT (CHECK (typpozadavek IN ('N', 'Z', 'V')) CONSTRAINT es_pozpodklad_mat_c2),
ADD CONSTRAINT (CHECK (typ IN ('E', 'U')) CONSTRAINT es_pozpodklad_mat_c3),
ADD CONSTRAINT (CHECK (typkomunikace IN ('E', 'M')) CONSTRAINT es_pozpodklad_mat_c4);

CREATE TABLE es_pozpodklad_arch (
  idarch   SERIAL NOT NULL,
  serno   INTEGER NOT NULL,
  typ   CHAR(1) NOT NULL,
  stav   CHAR(1) NOT NULL,
  refpozadavek   INTEGER NOT NULL,
  typpozadavek   CHAR(1) NOT NULL,
  poradipodkladu   Integer NOT NULL,
  datzpracdo   DATE NOT NULL,
  poradizprac   Integer NOT NULL,
  typkomunikace   CHAR(1) NOT NULL,
  email   VARCHAR(255),
  emailcc   VARCHAR(255),
  portime   datetime year to second NOT NULL,
  poruser   CHAR(20)  DEFAULT USER NOT NULL,
  zpractime   datetime year to second,
  zpracuser   CHAR(20),
  zrustime   datetime year to second,
  zrususer   CHAR(20),
  reftime   DATETIME YEAR TO SECOND  DEFAULT CURRENT YEAR TO SECOND NOT NULL,
  refuser   CHAR(20)  DEFAULT USER NOT NULL,
  oz_cislo   DECIMAL(16, 0),
  oz_cisloext   CHAR(8),
  oz_cislopcp   DECIMAL(16, 0),
  oz_titul1   CHAR(10),
  oz_jmeno   CHAR(24),
  oz_prijmeni   CHAR(35),
  oz_titul2   CHAR(10),
  oz_adr1   CHAR(45),
  oz_adr2   CHAR(45),
  oz_psc   CHAR(5),
  oz_adr3   CHAR(45),
  oz_email   CHAR(40),
  oz_telefon   CHAR(40),
  ozter_cislo   Integer,
  ozter_nazev   CHAR(40),
  ozter_adr1   CHAR(45),
  ozter_adr2   CHAR(45),
  ozter_psc   CHAR(5),
  ozter_adr3   CHAR(45),
  ozter_email   VARCHAR(255),
  ozter_telefon   CHAR(40),
  ozorg_cislo   Integer,
  ozorg_nazev   CHAR(40),
  ozorg_adr1   CHAR(45),
  ozorg_adr2   CHAR(45),
  ozorg_psc   CHAR(5),
  ozorg_adr3   CHAR(45),
  ozorg_email   VARCHAR(255),
  ozorg_telefon   CHAR(40),
  ozhigh_cislo   DECIMAL(16, 0),
  ozhigh_titul1   CHAR(10),
  ozhigh_jmeno   CHAR(24),
  ozhigh_prijmeni   CHAR(35),
  ozhigh_titul2   CHAR(10),
  ozhigh_adr1   CHAR(45),
  ozhigh_adr2   CHAR(45),
  ozhigh_psc   CHAR(5),
  ozhigh_adr3   CHAR(45),
  ozhigh_email   VARCHAR(255),
  ozhigh_telefon   CHAR(40),
  ozhighter_cislo   Integer,
  ozhighter_nazev   CHAR(40),
  ozhighter_adr1   CHAR(45),
  ozhighter_adr2   CHAR(45),
  ozhighter_psc   CHAR(5),
  ozhighter_adr3   CHAR(45),
  ozhighter_email   VARCHAR(255),
  ozhighter_telefon   CHAR(40),
  poz_smlouva   DECIMAL(16, 0),
  poz_tsml   CHAR(4),
  poz_cc   DECIMAL(16, 2),
  poz_vop   Integer,
  poz_tarif   Integer,
  poz_sp   Integer,
  poz_datuz   DATE,
  pozkl_typid   CHAR(1),
  pozkl_rc   CHAR(13),
  pozkl_titul1   CHAR(10),
  pozkl_jmeno   CHAR(24),
  pozkl_prijmeni   CHAR(35),
  pozkl_titul2   CHAR(10),
  pozkl_datnaroz   DATE,
  pozkl_pohlavi   Integer,
  pozkl_statprisl   CHAR(2),
  pozkl_adresat   CHAR(45),
  pozkl_ulice   CHAR(45),
  pozkl_cislopopisne   CHAR(8),
  pozkl_cisloorientacni   CHAR(8),
  pozkl_psc   CHAR(5),
  pozkl_obec   CHAR(60),
  pozkl_stat   CHAR(2),
  pozzz_typid   CHAR(1),
  pozzz_rc   CHAR(13),
  pozzz_titul1   CHAR(10),
  pozzz_jmeno   CHAR(24),
  pozzz_prijmeni   CHAR(35),
  pozzz_titul2   CHAR(10),
  pozzz_datnaroz   DATE,
  pozzz_pohlavi   Integer,
  pozzz_statprisl   CHAR(2),
  pozzz_adresat   CHAR(45),
  pozzz_ulice   CHAR(45),
  pozzz_cislopopisne   CHAR(8),
  pozzz_cisloorientacni   CHAR(8),
  pozzz_psc   CHAR(5),
  pozzz_obec   CHAR(60),
  pozzz_stat   CHAR(2),
  pozka_adresat   CHAR(45),
  pozka_ulice   CHAR(45),
  pozka_cislopopisne   CHAR(8),
  pozka_cisloorientacni   CHAR(8),
  pozka_psc   CHAR(5),
  pozka_obec   CHAR(60),
  pozka_stat   CHAR(2)
)lock mode row;

--PK
CREATE UNIQUE INDEX es_pozpodklad_arch_pk ON es_pozpodklad_arch(idarch);
ALTER TABLE es_pozpodklad_arch ADD CONSTRAINT PRIMARY KEY(idarch) CONSTRAINT es_pozpodklad_arch_pk;


--
-- es_pozpodkladprob_mat + arch
--
CREATE TABLE es_pozpodkladprob_mat (
  refpodklad   INTEGER NOT NULL,
  poradi   Integer  DEFAULT 1 NOT NULL,
  poznamkapoz   CHAR(160),
  refproblemtyp   SMALLINT NOT NULL,
  nazev   CHAR(70),
  formsekce   VARCHAR(255),
  kod  INT,
  stupen   Integer NOT NULL,
  zakazpredani   Integer  DEFAULT 0 NOT NULL,
  odpovednapapir   Integer  DEFAULT 0 NOT NULL,
  poznamka   CHAR(70),
  portime   datetime year to second NOT NULL,
  poruser   CHAR(20) NOT NULL,
  reftime   DATETIME YEAR TO SECOND  DEFAULT CURRENT YEAR TO SECOND NOT NULL,
  refuser   CHAR(20)  DEFAULT USER NOT NULL,
  CHECK (zakazpredani IN (0,1)) CONSTRAINT es_pozpodkladprob_mat_ddfb,
  CHECK (odpovednapapir IN (0,1)) CONSTRAINT es_pozpodkladprob_mat_ddfc
)lock mode row;

--FK
CREATE INDEX es_pozpodkladprob_mat_i_f1 ON es_pozpodkladprob_mat(refpodklad);
ALTER TABLE es_pozpodkladprob_mat ADD CONSTRAINT FOREIGN KEY(refpodklad) REFERENCES es_pozpodklad_mat(serno) CONSTRAINT es_pozpodkladprob_mat_f1;
CREATE INDEX es_pozpodkladprob_mat_i_f2 ON es_pozpodkladprob_mat(refproblemtyp);
ALTER TABLE es_pozpodkladprob_mat ADD CONSTRAINT FOREIGN KEY(refproblemtyp) REFERENCES es_problem_cis(typ) CONSTRAINT es_pozpodkladprob_mat_f2;

CREATE TABLE es_pozpodkladprob_arch (
  idarch   SERIAL NOT NULL,
  refpodklad   INTEGER NOT NULL,
  poradi   Integer NOT NULL,
  poznamkapoz   CHAR(160),
  refproblemtyp   SMALLINT NOT NULL,
  nazev   CHAR(70),
  formsekce   VARCHAR(255),
  kod   INT,
  stupen   Integer NOT NULL,
  zakazpredani   Integer  DEFAULT 0 NOT NULL,
  odpovednapapir   Integer  DEFAULT 0 NOT NULL,
  poznamka   CHAR(70),
  portime   datetime year to second NOT NULL,
  poruser   CHAR(20) NOT NULL,
  reftime   DATETIME YEAR TO SECOND  DEFAULT CURRENT YEAR TO SECOND NOT NULL,
  refuser   CHAR(20)  DEFAULT USER NOT NULL,
  CHECK (zakazpredani IN (0,1)) CONSTRAINT es_pozpodkladprob_arch_ddfb,
  CHECK (odpovednapapir IN (0,1)) CONSTRAINT es_pozpodkladprob_arch_ddfc
)lock mode row;

--PK
CREATE UNIQUE INDEX es_pozpodkladprob_arch_pk ON es_pozpodkladprob_arch(idarch);
ALTER TABLE es_pozpodkladprob_arch ADD CONSTRAINT PRIMARY KEY(idarch) CONSTRAINT es_pozpodkladprob_arch_pk;

ROLLBACK WORK;

--End of A55413_RN00317078_1-es_pozproblem